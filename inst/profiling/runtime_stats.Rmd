---
title: "R Notebook"
output: html_notebook
---

```{r setup}
library(dplyr)
library(ggplot2)
knitr::opts_chunk$set(fig.width=6, fig.height=5) 
```

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
times <- read.csv(here::here("inst/profiling/refactor_timing.csv"))
```

```{r}
palette <- c("#0173b2", "#de8f05", "#029e73", "#d55e00", "#cc78bc", 
             "#ca9161", "#fbafe4", "#949494", "#ece133", "#56b4e9")

p1 <- ggplot(data=times, aes(x=nspots, y=elapsed, color=factor(nrep))) +
    geom_point() +
    geom_line(aes(linetype=factor(method))) +
    scale_color_manual(values=palette) +
    labs(title="Runtime", color="# iterations", linetype="Method") +
    xlab("Number of spots") +
    ylab("Runtime (seconds)") +
    theme_bw()
```

```{r}
times$sec_per <- (times$elapsed / times$nspots) / times$nrep

set.seed(149)
p2 <- ggplot(data=times, aes(x=factor(method), y=sec_per)) +
    geom_boxplot(outlier.shape=NA) +
    geom_jitter(aes(color=factor(nrep), shape=factor(nspots)), height=0, size=2.5, width=0.1) +
    scale_color_manual(values=palette) +
    ylim(0, 1e-5) +
    labs(title="Runtime comparison", color="# iterations", shape="# spots") +
    xlab("Method") +
    ylab("Runtime (seconds per spot per iteration)") +
    theme_bw()
```

```{r fig.width=8, fig.height=4}
library(patchwork)
p1 + p2
# ggsave(here::here("inst/profiling/runtime_comparison.rhino.pdf"))
```


```{r}
delta <- times %>% 
    group_by(nspots, nrep) %>% 
    summarise(frac_time=sec_per[method=='refactor'] / sec_per[method=='original'])

ggplot(data=delta, aes(x=factor(nspots), y=frac_time, group=factor(nrep), fill=factor(nrep))) + 
    geom_col(position='dodge') +
    scale_fill_manual(values=palette) +
    ylim(0, 1) +
    labs(title="Runtime comparison", fill="# iterations") +
    xlab("Number of spots") +
    ylab("Fraction of original runtime") +
    theme_bw()
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

