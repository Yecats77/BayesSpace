<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Joint Clustering Analysis • BayesSpace</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Joint Clustering Analysis">
<meta property="og:description" content="BayesSpace">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BayesSpace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BayesSpace.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/maynard_DLPFC.html">DLPFC (Maynard et al., 2020)</a>
    </li>
    <li>
      <a href="../articles/ji_SCC.html">SCC (Ji et al., 2020)</a>
    </li>
    <li>
      <a href="../articles/thrane_melanoma.html">Melanoma (Thrane et al., 2018)</a>
    </li>
    <li>
      <a href="../articles/joint_clustering.html">Joint clustering</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/edward130603/BayesSpace">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="joint_clustering_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Joint Clustering Analysis</h1>
                        <h4 class="author">Edward Zhao, Matt Stone, and Raphael Gottardo</h4>
            
            <h4 class="date">2021-08-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/edward130603/BayesSpace/blob/master/vignettes/joint_clustering.Rmd"><code>vignettes/joint_clustering.Rmd</code></a></small>
      <div class="hidden name"><code>joint_clustering.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">harmony</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BayesSpace</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>In this vignette, we describe how to perform a joint clustering analysis of 4 serial sections of the dorsolateral prefrontal cortex. The samples are 151673-151676, first described by <a href="https://www.nature.com/articles/s41593-020-00787-0">Maynard et al. (2021)</a>.</p>
<div id="loading-and-preprocessing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-and-preprocessing-data" class="anchor"></a>Loading and preprocessing data</h2>
<p>The samples are available in the BayesSpace package via the <code><a href="../reference/getRDS.html">getRDS()</a></code> function. The plots of the ground truth clusters (which were obtained through manual expert annotation) suggest that jointly modeling the samples may be beneficial.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce1</span> <span class="op">=</span> <span class="fu"><a href="../reference/getRDS.html">getRDS</a></span><span class="op">(</span><span class="st">"2020_maynard_prefrontal-cortex"</span>, <span class="st">"151673"</span><span class="op">)</span>
<span class="va">sce2</span> <span class="op">=</span> <span class="fu"><a href="../reference/getRDS.html">getRDS</a></span><span class="op">(</span><span class="st">"2020_maynard_prefrontal-cortex"</span>, <span class="st">"151674"</span><span class="op">)</span>
<span class="va">sce3</span> <span class="op">=</span> <span class="fu"><a href="../reference/getRDS.html">getRDS</a></span><span class="op">(</span><span class="st">"2020_maynard_prefrontal-cortex"</span>, <span class="st">"151675"</span><span class="op">)</span>
<span class="va">sce4</span> <span class="op">=</span> <span class="fu"><a href="../reference/getRDS.html">getRDS</a></span><span class="op">(</span><span class="st">"2020_maynard_prefrontal-cortex"</span>, <span class="st">"151676"</span><span class="op">)</span>

<span class="op">(</span><span class="op">(</span><span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce1</span>, <span class="st">"layer_guess_reordered"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">|</span>
  <span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce2</span>, <span class="st">"layer_guess_reordered"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span>
  <span class="op">(</span><span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce3</span>, <span class="st">"layer_guess_reordered"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">|</span>
  <span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce4</span>, <span class="st">"layer_guess_reordered"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Ground truth"</span><span class="op">)</span></code></pre></div>
<p><img src="figures/joint_clustering-getRDS-1.png" title="plot of chunk getRDS" alt="plot of chunk getRDS" width="100%"></p>
<p>The <code>rowData</code> for each sample contains previously calculated highly variable genes (HVGs), which are not consistent across samples. These need to be removed and recalculated after combining into one SingleCellExperiment object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rowData</span><span class="op">(</span><span class="va">sce1</span><span class="op">)</span><span class="op">$</span><span class="va">is.HVG</span> <span class="op">=</span> <span class="cn">NULL</span> 
<span class="fu">rowData</span><span class="op">(</span><span class="va">sce2</span><span class="op">)</span><span class="op">$</span><span class="va">is.HVG</span> <span class="op">=</span> <span class="cn">NULL</span> 
<span class="fu">rowData</span><span class="op">(</span><span class="va">sce3</span><span class="op">)</span><span class="op">$</span><span class="va">is.HVG</span> <span class="op">=</span> <span class="cn">NULL</span> 
<span class="fu">rowData</span><span class="op">(</span><span class="va">sce4</span><span class="op">)</span><span class="op">$</span><span class="va">is.HVG</span> <span class="op">=</span> <span class="cn">NULL</span> 

<span class="co">#Combine into 1 SCE and preprocess</span>
<span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">sce1</span>, <span class="va">sce2</span>, <span class="va">sce3</span>, <span class="va">sce4</span>, deparse.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="../reference/spatialPreprocess.html">spatialPreprocess</a></span><span class="op">(</span><span class="va">sce.combined</span>, n.PCs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="co">#lognormalize, PCA</span></code></pre></div>
</div>
<div id="batch-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#batch-correction" class="anchor"></a>Batch correction</h2>
<p>We aim for our clustering analysis to capture biological patterns across the four samples rather than technical differences between each sample. It is a good idea to check for batch effects first by plotting a low-dimensional representation of the data. Note here the sample name is stored in <code>colData(sce.combined)</code> in the column <code>sample_name</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html">runUMAP</a></span><span class="op">(</span><span class="va">sce.combined</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"UMAP"</span><span class="op">)</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"UMAP"</span><span class="op">)</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">UMAP1</span>, y <span class="op">=</span> <span class="va">UMAP2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="figures/joint_clustering-batch-1.png" title="plot of chunk batch" alt="plot of chunk batch" width="100%"></p>
<p>There is a noticeable batch effect. We use <a href="https://portals.broadinstitute.org/harmony/index.html">Harmony</a> to integrate the four samples.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("immunogenomics/harmony")</span>

<span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/harmony/man/RunHarmony.html">RunHarmony</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"sample_name"</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html">runUMAP</a></span><span class="op">(</span><span class="va">sce.combined</span>, dimred <span class="op">=</span> <span class="st">"HARMONY"</span>, name <span class="op">=</span> <span class="st">"UMAP.HARMONY"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"UMAP.HARMONY"</span><span class="op">)</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"UMAP.HARMONY"</span><span class="op">)</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">UMAP1</span>, y <span class="op">=</span> <span class="va">UMAP2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="figures/joint_clustering-harmony-1.png" title="plot of chunk harmony" alt="plot of chunk harmony" width="100%"></p>
</div>
<div id="clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h2>
<p>After integration, there appears to be no obvious batch effect. We now prepare the samples for joint clustering. The spatial locations for each sample need to be offset so that spots of different samples are not neighbors. Here, we add 100 to row and/or 150 to col to achieve this effect. In this dataset, row ranges from 0 to 77 while col ranges from 0 to 127. Here, <code>row</code> and <code>col</code> are also columns of <code>colData(sce.combined)</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce.combined</span><span class="op">$</span><span class="va">row</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151674"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fl">100</span> <span class="op">+</span> <span class="va">sce.combined</span><span class="op">$</span><span class="va">row</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151674"</span><span class="op">]</span>
<span class="va">sce.combined</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151675"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fl">150</span> <span class="op">+</span> <span class="va">sce.combined</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151675"</span><span class="op">]</span>
<span class="va">sce.combined</span><span class="op">$</span><span class="va">row</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151676"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fl">100</span> <span class="op">+</span> <span class="va">sce.combined</span><span class="op">$</span><span class="va">row</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151676"</span><span class="op">]</span>
<span class="va">sce.combined</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151676"</span><span class="op">]</span> <span class="op">=</span> 
  <span class="fl">150</span> <span class="op">+</span> <span class="va">sce.combined</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="st">"151676"</span><span class="op">]</span>
<span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce.combined</span>, <span class="st">"sample_name"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="co">#make sure no overlap between samples</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Sample"</span>, title <span class="op">=</span> <span class="st">"Offset check"</span><span class="op">)</span></code></pre></div>
<p><img src="figures/joint_clustering-offset-1.png" title="plot of chunk offset" alt="plot of chunk offset" width="100%"></p>
<p>The plot shows the samples are not overlapping, so the neighborhood network will be detected correctly. We proceed to use BayesSpace for clustering.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce.combined</span> <span class="op">=</span> <span class="fu"><a href="../reference/spatialCluster.html">spatialCluster</a></span><span class="op">(</span><span class="va">sce.combined</span>, use.dimred <span class="op">=</span> <span class="st">"HARMONY"</span>, q <span class="op">=</span> <span class="fl">7</span>, nrep <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="co">#use HARMONY</span>
<span class="fu"><a href="../reference/clusterPlot.html">clusterPlot</a></span><span class="op">(</span><span class="va">sce.combined</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="co">#plot clusters</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"BayesSpace joint clustering"</span><span class="op">)</span></code></pre></div>
<p><img src="figures/joint_clustering-cluster-1.png" title="plot of chunk cluster" alt="plot of chunk cluster" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#calculate ARIs</span>
<span class="va">aris</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">aris</span><span class="op">)</span> <span class="op">=</span> <span class="fl">151673</span><span class="op">:</span><span class="fl">151676</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">sample.id</span> <span class="kw">in</span> <span class="fl">151673</span><span class="op">:</span><span class="fl">151676</span><span class="op">)</span><span class="op">{</span>
  <span class="va">aris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">sample.id</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> 
    <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/adjustedRandIndex.html">adjustedRandIndex</a></span><span class="op">(</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">spatial.cluster</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="va">sample.id</span><span class="op">]</span>,
                              <span class="va">sce.combined</span><span class="op">$</span><span class="va">layer_guess</span><span class="op">[</span><span class="va">sce.combined</span><span class="op">$</span><span class="va">sample_name</span> <span class="op">==</span> <span class="va">sample.id</span><span class="op">]</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<p>The results of the joint clustering show consistent structure across samples. Comparing to the ground truth, we obtain ARIs of 0.56, 0.59, 0.6, and 0.57 for the four samples. This represents a substantial improvement over the single sample clustering analyses, where we obtained values of 0.55, 0.44, 0.55, and 0.37 respectively for the four samples.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edward Zhao, Matt Stone.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
